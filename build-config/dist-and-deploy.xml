<?xml version="1.0" encoding="UTF-8"?>
<project name="Kieker (dist and deploy)" basedir=".." xmlns:artifact="antlib:org.apache.maven.artifact.ant">

	<property file="build-config/build.properties" />
	
	<import file="init-and-clean.xml"/>
	<import file="compile-and-build.xml"/>
	<import file="test.xml"/>
	<import file="quality.xml"/>
	
	<path id="maven-ant-tasks.classpath" path="lib/maven-ant-tasks-2.1.3.jar" />
	<typedef resource="org/apache/maven/artifact/ant/antlib.xml"
					 uri="antlib:org.apache.maven.artifact.ant"
					 classpathref="maven-ant-tasks.classpath" />

	<target name="dist-kieker-javadoc" depends="-init,-generate-javadoc" description="Packages the Javadoc API documentation archives">
		<tar destfile="${release.dir}/${dist.kieker.apiBaseName}.tar" longfile="gnu">
			<tarfileset dir="${build.api.dir}" prefix="" defaultexcludes="yes" />
		</tar>
		<gzip zipfile="${release.dir}/${dist.kieker.apiBaseName}.tar.gz" src="${release.dir}/${dist.kieker.apiBaseName}.tar" />
		<!-- tar file no longer needed -->
		<delete file="${release.dir}/${dist.kieker.apiBaseName}.tar" />

		<zip zipfile="${release.dir}/${dist.kieker.apiBaseName}.zip">
			<zipfileset dir="${build.api.dir}" prefix="" defaultexcludes="yes" />
		</zip>
	</target>

	<target name="dist-kieker-userguide" depends="-init,-build-userguide" description="Packages the Kieker user guide">
		<copy file="${src.userguide.pdf}" tofile="${release.dir}/${dist.kieker.userguide.pdf}" />
	</target>

	<target name="-generate-javadoc" depends="-init" description="Generate the Javadoc API documentation">
		<delete dir="${build.api.dir}" />
		<mkdir dir="${build.api.dir}" />
		<path id="javadoc-sourcepath">
			<dirset dir=".">
				<include name="${src.kieker.common.dir}" />
				<include name="${src.kieker.analysis.dir}" />
				<include name="${src.gen.kieker.analysis.dir}" />
				<include name="${src.gen.kieker.common.dir}" />
				<include name="${src.gen.kieker.tools.dir}" />
				<include name="${src.kieker.monitoring.dir}" />
				<include name="${src.kieker.tools.dir}" />
			</dirset>
		</path>
		<javadoc stylesheetfile="${build.config.dir}/javadoc-header/javadoc.css" sourcepathref="javadoc-sourcepath" destdir="${build.api.dir}" packagenames="kieker.*" access="public" author="true" version="false" failonerror="true" use="true" doctitle="Kieker Monitoring and Analysis Framework, Vers. ${kieker.version}&lt;br/&gt;API Documentation" header="Kieker ${kieker.version}" footer="Kieker ${kieker.version}" bottom="Copyright ${year} ${copyright}, &lt;a href=&quot;http://kieker-monitoring.net&quot;&gt;http://kieker-monitoring.net&lt;/&gt;">
			<classpath refid="kieker.common-compile-classpath" />
			<classpath refid="kieker.analysis-compile-classpath" />
			<classpath refid="kieker.monitoring-compile-classpath" />
			<classpath refid="kieker.monitoring-ajc-compile-classpath" />
			<classpath refid="kieker.tools-compile-classpath" />
			<link href="http://docs.oracle.com/javase/6/docs/api/" />
			<tag name="generated" />
			<tag name="ordered" />
			<tag name="model" />
		</javadoc>
		<copy file="${build.config.dir}/javadoc-header/kieker-javadoc-header.png" todir="${build.api.dir}/resources"/>
	</target>

	<target name="dist-kieker-sources" depends="-init" description="Packages the source archives (.zip|.tar.gz) for a release">
		<!-- <echo message="${test.dir}/monitoring/kieker/test/monitoring/junit/probe/spring/executions/jetty/jetty.xml" /> -->
		<patternset id="dist_src_files-nonbinmode"> <!-- NOTE that the order of includes/excludes seems to have no effect. So be careful with excludes -->
			<include name="${build.config.dir}/**/*" />
			<include name="${bin.dir}/*.properties" />
			<include name="${bin.dir}/*.bat" />
			<include name="${src.userguide.dir}/**/*" />
			<exclude name="${src.userguide.dir}/**/*.sh" /> <!-- will be added in bin mode -->
			<include name="${src.dir}/**/*.java" />
			<include name="${src.dir}/**/META-INF/*" />
			<include name="${src.gen}/**/*.java" />
			<include name="${src.model.dir}/**/*.irl" />
			<include name="${src.model.dir}/analysis/*.ecore" />
			<include name="${src.model.dir}/analysis/*.ecorediag" />
			<include name="${src.model.dir}/analysis/*.genmodel" />
			<include name="${test.dir}/**/*.java" />
			<include name="${test.dir}/**/META-INF/*" />
			<include name="${test.dir}/monitoring/kieker/test/monitoring/junit/probe/spring/executions/jetty/jetty.xml" />
			<include name="${test.dir}/monitoring/kieker/test/monitoring/junit/probe/spring/executions/jetty/webapp/**" />
			<include name="${test.gen.dir}/**/*.java" />
			<include name="${lib.dir}/**/*" />
			<include name="${examples.dir}/**/*" />
			<exclude name="${examples.dir}/**/.classpath-binrelease.generated" />
			<exclude name="${src.userguide.examples.dir}/**/lib/**/*" />
			<exclude name="${src.userguide.examples.dir}/**/**/*.jar" />
			<include name="${example.javaee.dir}/README" />
			<include name="${example.javaee.dir}/${license.file}" />
			<!-- (re-)enable as soon as existent <include name="${example.javaee.dir}/kieker-testdata/**" /> -->
			<include name="${example.javaee.jetty.dir}/**/*" />
			<exclude name="${example.javaee.jetty.dir}/logs/**/*" />
			<exclude name="${example.javaee.jetty.dir}/**/kieker*.jar" />
			<exclude name="${example.javaee.jpetstore.lib.dir}/*sigar*" />
			<exclude name="${example.javaee.demo.classes.dir}/**" />
			<include name=".settings/**/*" />
			<include name=".checkstyle" />
			<include name=".classpath" />
			<include name=".pmd" />
			<include name=".project" />
			<include name="kieker-eclipse.importorder" />
			<include name="kieker-eclipse-cleanup.xml" />
			<include name="kieker-eclipse-formatter.xml" />
			<include name="build.xml" />
			<include name="build.properties" />
			<include name="${history.file}" />
			<include name="${license.file}" />
			<include name="${readme.src.file}" />
			<include name="${readme.bin.file}" />
			<exclude name="**/build-eclipse/**" />
		</patternset>
		<patternset id="dist_src_files-binmode">
			<include name="${bin.dir}/**/*.sh" /> <!-- including subdirs (e.g., ${bin.dir}/dev/) here -->
			<include name="${src.userguide.dir}/**/*.sh" />
		</patternset>

		<tar destfile="${release.dir}/${dist.kieker.srcBaseName}.tar" longfile="gnu">
			<tarfileset dir="." prefix="${kieker.dist.name}" defaultexcludes="yes">
				<patternset refid="dist_src_files-nonbinmode" />
			</tarfileset>
			<tarfileset dir="." prefix="${kieker.dist.name}" filemode="755" defaultexcludes="yes">
				<patternset refid="dist_src_files-binmode" />
			</tarfileset>
			<tarfileset file="${readme.src.file}" fullpath="${kieker.dist.name}/${readme.file}" />
		</tar>
		<gzip zipfile="${release.dir}/${dist.kieker.srcBaseName}.tar.gz" src="${release.dir}/${dist.kieker.srcBaseName}.tar" />
		<!-- tar file no longer needed -->
		<delete file="${release.dir}/${dist.kieker.srcBaseName}.tar" />

		<zip zipfile="${release.dir}/${dist.kieker.srcBaseName}.zip">
			<zipfileset dir="." prefix="${kieker.dist.name}" defaultexcludes="yes">
				<patternset refid="dist_src_files-nonbinmode" />
			</zipfileset>
			<zipfileset dir="." prefix="${kieker.dist.name}" filemode="755" defaultexcludes="yes">
				<patternset refid="dist_src_files-binmode" />
			</zipfileset>
			<zipfileset file="${readme.src.file}" fullpath="${kieker.dist.name}/${readme.file}" />
		</zip>
	</target>

	<target name="dist-maven" depends="build-all,-generate-javadoc,-build-userguide" description="Creates the Kieker release artifacts to be uploaded to a Maven repository">
		<!-- The "real" jar files -->
		<copy file="${dist.dir}/${dist.kieker.main.jar}" tofile="${maven.dir}/${dist.kieker.main.jar}" />
		<copy file="${dist.dir}/${dist.kieker.main.emf.jar}" tofile="${maven.dir}/${dist.kieker.main.emf.jar}" />
		<copy file="${dist.dir}/${dist.kieker.main.aspectj.jar}" tofile="${maven.dir}/${dist.kieker.main.aspectj.jar}" />
		<!-- The userguide -->
		<copy file="${src.userguide.pdf}" tofile="${maven.dir}/${dist.kieker.userguide.pdf}" />
		<!-- The source files -->
		<jar zipfile="${maven.dir}/${dist.kieker.main.sources.jar}">
			<zipfileset dir="${src.kieker.common.dir}" defaultexcludes="yes" />
			<zipfileset dir="${src.kieker.monitoring.dir}" defaultexcludes="yes" />
			<zipfileset dir="${src.kieker.analysis.dir}" defaultexcludes="yes" />
			<zipfileset dir="${src.kieker.tools.dir}" defaultexcludes="yes" />
			<zipfileset dir="${src.gen.kieker.analysis.dir}" defaultexcludes="yes" />
		</jar>
		<!-- The javadoc files -->
		<jar zipfile="${maven.dir}/${dist.kieker.main.javadoc.jar}">
			<zipfileset dir="${build.api.dir}" prefix="" defaultexcludes="yes" />
		</jar>
		<!-- The pom files -->
		<copy file="${pom.xml.kieker.main}" tofile="${maven.dir}/${dist.kieker.main.pom}" />
		<!-- update version -->
		<replaceregexp file="${maven.dir}/${dist.kieker.main.pom}" match="&lt;version&gt;.*&lt;/version&gt;&lt;!--Kieker.*" replace="&lt;version&gt;${kieker.version}&lt;/version&gt;" />
	</target>

	<!-- Note that this target just uploads but does NOT build! -->
	<target name="deploy-maven-snapshot" depends="-update-version" description="deploy snapshot version to Maven snapshot repository">
		<!-- deploy the main artifacts -->
		<artifact:mvn>
			<arg value="org.apache.maven.plugins:maven-deploy-plugin:2.7:deploy-file" />
			<arg value="-Durl=${maven-snapshots-repository-url}" />
			<arg value="-DrepositoryId=${maven-snapshots-repository-id}" />
			<arg value="-DpomFile=${maven.dir}/${dist.kieker.main.pom}" />
			<arg value="-Dfile=${maven.dir}/${dist.kieker.main.jar}" />
			<arg value="-Dsources=${maven.dir}/${dist.kieker.main.sources.jar}" />
			<arg value="-Djavadoc=${maven.dir}/${dist.kieker.main.javadoc.jar}" />
			<arg value="-Dclassifiers=emf,aspectj,userguide" />
			<arg value="-Dtypes=jar,jar,pdf" />
			<arg value="-Dfiles=${maven.dir}/${dist.kieker.main.emf.jar},${maven.dir}/${dist.kieker.main.aspectj.jar},${maven.dir}/${dist.kieker.userguide.pdf}" />
		</artifact:mvn>
	</target>

	<!-- Note that this target just uploads but does NOT build! -->
	<target name="deploy-maven-release" depends="-update-version" description="deploy release version to Maven snapshot repository">
		<!-- sign and deploy all artifacts -->
		<artifact:mvn>
			<arg value="org.apache.maven.plugins:maven-gpg-plugin:1.4:sign-and-deploy-file" />
			<arg value="-Durl=${maven-staging-repository-url}" />
			<arg value="-DrepositoryId=${maven-staging-repository-id}" />
			<arg value="-DpomFile=${maven.dir}/${dist.kieker.main.pom}" />
			<arg value="-Dfile=${maven.dir}/${dist.kieker.main.jar}" />
			<arg value="-Dsources=${maven.dir}/${dist.kieker.main.sources.jar}" />
			<arg value="-Djavadoc=${maven.dir}/${dist.kieker.main.javadoc.jar}" />
			<arg value="-Dclassifiers=emf,aspectj,userguide" />
			<arg value="-Dtypes=jar,jar,pdf" />
			<arg value="-Dfiles=${maven.dir}/${dist.kieker.main.emf.jar},${maven.dir}/${dist.kieker.main.aspectj.jar},${maven.dir}/${dist.kieker.userguide.pdf}" />
			<arg value="-Pgpg" />
		</artifact:mvn>
	</target>

	<target name="dist-kieker-binaries" depends="build-all,-build-userguide,-build-userguide-examples,-prepare-userguide-examples-binary-release,-compile-javaee.demo" description="Packages the binary archives (.zip|.tar.gz) for a release">
		<patternset id="dist_bin_files-nonbinmode"> <!-- NOTE that the order of includes/excludes seems to have no effect. So be careful with excludes -->
			<include name="${history.file}" />
			<include name="${license.file}" />
			<include name="${bin.dir}/*.properties" />
			<include name="${bin.dir}/*.bat" />
			<include name="${dist.dir}/*.jar" />
			<include name="${dist.dir}/*.war" />
			<include name="${lib.dir}/**/*" />
			<exclude name="${lib.dir}/static-analysis/" />
			<exclude name="${lib.dir}/detect-dependency-updates/" />
			<!-- exclude some src only libraries begin -->
			<exclude name="${lib.dir}/aspectjtools-*" />
			<exclude name="${lib.dir}/maven-ant-tasks-*" />
			<exclude name="${lib.dir}/junit-*" />
			<exclude name="${lib.dir}/hamcrest-core-*" />
			<!-- exclude some src only libraries end -->
			<include name="${src.userguide.dist.pdf}" />
			<include name="${examples.dir}/**/*" />
			<exclude name="${examples.dir}/**/*.sh" /> <!-- added in bin mode below -->
			<exclude name="${examples.dir}/**/.classpath*" />
			<exclude name="${src.userguide.examples.dir}/**/lib/**/*" />
			<include name="${example.javaee.dir}/README" />
			<exclude name="${example.javaee.dir}/build.xml" />
			<exclude name="${example.javaee.dir}/livedemo-source/**" />
			<include name="${example.javaee.dir}/${license.file}" />
			<!-- (re-)enable as soon as existent <include name="${example.javaee.dir}/kieker-testdata/**" /> -->
			<include name="${example.javaee.jetty.dir}/**" />
			<exclude name="${example.javaee.jetty.dir}/logs/**/*" />
			<exclude name="${example.javaee.jetty.dir}/**/kieker*.jar" />
			<exclude name="${example.javaee.jpetstore.lib.dir}/*sigar*" />
			<exclude name="**/build-eclipse/**" />
		</patternset>
		<patternset id="dist_bin_files-binmode">
			<include name="${bin.dir}/*.sh" /> <!-- excluding subdirs (e.g., ${bin.dir}/dev/) here -->
			<include name="${examples.dir}/**/*.sh" />
		</patternset>

		<tar destfile="${release.dir}/${dist.kieker.binBaseName}.tar" longfile="gnu">
			<tarfileset file="${kieker.monitoring.default.properties}" fullpath="${kieker.dist.name}/${examples.dir}/kieker.monitoring.example.properties" />
			<tarfileset file="${src.userguide.pdf}" fullpath="${kieker.dist.name}/doc/${dist.kieker.userguide.pdf}" />
			<tarfileset dir="." prefix="${kieker.dist.name}" defaultexcludes="yes">
				<patternset refid="dist_bin_files-nonbinmode" />
			</tarfileset>
			<tarfileset dir="." prefix="${kieker.dist.name}" filemode="755" defaultexcludes="yes">
				<patternset refid="dist_bin_files-binmode" />
			</tarfileset>

			<tarfileset file="${readme.bin.file}" fullpath="${kieker.dist.name}/${readme.file}" />

			<tarfileset file="${kieker.monitoring.default.properties}"
						fullpath="${kieker.dist.name}/${example.javaee.jetty.dir}/kieker.monitoring.properties" />

			<!-- Include tailored Eclipse files in the examples -->
			<tarfileset file="${src.userguide.example.bookstore.dir}/.classpath"
						fullpath="${kieker.dist.name}/${src.userguide.example.bookstore.dir}/.classpath" /> <!-- leave "as-is" -->
			<tarfileset file="${src.userguide.example.manual.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.userguide.example.manual.dir}/.classpath" />
			<tarfileset file="${src.userguide.example.extended.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.userguide.example.extended.dir}/.classpath" />
			<tarfileset file="${src.userguide.example.aspectj.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.userguide.example.aspectj.dir}/.classpath" />
			<tarfileset file="${src.userguide.example.jms.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.userguide.example.jms.dir}/.classpath" />
			<tarfileset file="${src.userguide.example.sigar.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.userguide.example.sigar.dir}/.classpath" />
			<tarfileset file="${src.example.analysis.kax.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.analysis.kax.dir}/.classpath" />	
			<tarfileset file="${src.example.analysis.opad.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.analysis.opad.dir}/.classpath" />				
			<tarfileset file="${src.example.monitoring.adaptive.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.monitoring.adaptive.dir}/.classpath" />	
			<tarfileset file="${src.example.monitoring.timesource.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.monitoring.timesource.dir}/.classpath" />	
			<tarfileset file="${src.example.monitoring.aspectj.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.monitoring.aspectj.dir}/.classpath" />	
			<tarfileset file="${src.example.monitoring.manual.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.monitoring.manual.dir}/.classpath" />	
			<tarfileset file="${src.example.monitoring.spring.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.monitoring.spring.dir}/.classpath" />	
			<tarfileset file="${src.example.monitoring.jvm.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.monitoring.jvm.dir}/.classpath" />	
			<tarfileset file="${src.example.monitoring.sigar.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.monitoring.sigar.dir}/.classpath" />
						
			<!-- Include the right Kieker libs (and licenses) in the examples -->
			<tarfileset file="${dist.dir}/${dist.kieker.main.aspectj.jar}"
						prefix="${kieker.dist.name}/${example.javaee.jpetstore.lib.dir}" />
			<tarfileset file="${license.file}"
						fullpath="${kieker.dist.name}/${example.javaee.jpetstore.lib.dir}/${dist.kieker.main.aspectj.jar}.LICENSE" />
			<tarfileset file="${dist.dir}/${dist.kieker.main.emf.jar}"
						prefix="${kieker.dist.name}/${src.userguide.example.manual.dir}/lib" />
			<tarfileset file="${dist.dir}/${dist.kieker.main.emf.jar}"
						prefix="${kieker.dist.name}/${src.userguide.example.extended.dir}/lib" />
			<tarfileset file="${dist.dir}/${dist.kieker.main.aspectj.jar}"
						prefix="${kieker.dist.name}/${src.userguide.example.aspectj.dir}/lib" />
			<tarfileset file="${dist.dir}/${dist.kieker.main.emf.jar}"
						prefix="${kieker.dist.name}/${src.userguide.example.jms.dir}/lib" />
			<tarfileset file="${lib.dir}/commons-logging-*.jar"
						prefix="${kieker.dist.name}/${src.userguide.example.jms.dir}/lib" />
			<tarfileset file="${dist.dir}/${dist.kieker.main.emf.jar}"
						prefix="${kieker.dist.name}/${src.userguide.example.sigar.dir}/lib" />
			<tarfileset file="${dist.dir}/${dist.kieker.main.emf.jar}"
						prefix="${kieker.dist.name}/${example.javaee.demo.lib.dir}" />
			<tarfileset file="${license.file}"
						fullpath="${kieker.dist.name}/${example.javaee.demo.lib.dir}/${dist.kieker.main.emf.jar}.LICENSE" />
			<tarfileset file="${lib.sigar.dir}/*"
						prefix="${kieker.dist.name}/${src.userguide.example.sigar.dir}/lib" />
			<tarfileset file="${lib.sigar.dir}/*"
						prefix="${kieker.dist.name}/${example.javaee.jpetstore.lib.dir}" />
			<tarfileset file="${dist.dir}/${dist.kieker.main.emf.jar}"
						prefix="${kieker.dist.name}/${src.example.analysis.kax.dir}/lib" />	
			<tarfileset file="${dist.dir}/${dist.kieker.main.emf.jar}"
						prefix="${kieker.dist.name}/${src.example.analysis.opad.dir}/lib" />	
			<tarfileset file="${lib.dir}/commons-lang3-*.jar"
						prefix="${kieker.dist.name}/${src.example.analysis.opad.dir}/lib" />
			<tarfileset file="${lib.dir}/commons-math3-*.jar"
						prefix="${kieker.dist.name}/${src.example.analysis.opad.dir}/lib" />			
			<tarfileset file="${dist.dir}/${dist.kieker.main.aspectj.jar}"
						prefix="${kieker.dist.name}/${src.example.monitoring.aspectj.dir}/lib" />		
			<tarfileset file="${dist.dir}/${dist.kieker.main.aspectj.jar}"
						prefix="${kieker.dist.name}/${src.example.monitoring.adaptive.dir}/lib" />		
			<tarfileset file="${dist.dir}/${dist.kieker.main.aspectj.jar}"
						prefix="${kieker.dist.name}/${src.example.monitoring.timesource.dir}/lib" />	
			<tarfileset file="${dist.dir}/${dist.kieker.main.jar}"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />	
			<tarfileset file="${dist.dir}/${dist.kieker.main.jar}"
						prefix="${kieker.dist.name}/${src.example.monitoring.manual.dir}/lib" />	
			<tarfileset file="${dist.dir}/${dist.kieker.main.jar}"
						prefix="${kieker.dist.name}/${src.example.monitoring.jvm.dir}/lib" />	
			<tarfileset file="${dist.dir}/${dist.kieker.main.jar}"
						prefix="${kieker.dist.name}/${src.example.monitoring.sigar.dir}/lib" />		
			<tarfileset file="${lib.sigar.dir}/*"
						prefix="${kieker.dist.name}/${src.example.monitoring.sigar.dir}/lib" />			
			<tarfileset file="${lib.spring.dir}/aopalliance-*.jar"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />				
			<tarfileset file="${lib.spring.dir}/spring-aop-*.jar"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />	
			<tarfileset file="${lib.spring.dir}/spring-beans-*.jar"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />				
			<tarfileset file="${lib.spring.dir}/spring-context-*.jar"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />	
			<tarfileset file="${lib.spring.dir}/spring-core-*.jar"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />	
			<tarfileset file="${lib.spring.dir}/spring-expression-*.jar"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />
			<tarfileset file="${lib.dir}/aspectjweaver-*.jar"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />
			<tarfileset file="${lib.dir}/commons-logging-*.jar"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />			
						
		</tar>
		<gzip zipfile="${release.dir}/${dist.kieker.binBaseName}.tar.gz" src="${release.dir}/${dist.kieker.binBaseName}.tar" />
		<!-- tar file no longer needed -->
		<delete file="${release.dir}/${dist.kieker.binBaseName}.tar" />

		<zip zipfile="${release.dir}/${dist.kieker.binBaseName}.zip">
			<zipfileset file="${kieker.monitoring.default.properties}" fullpath="${kieker.dist.name}/${examples.dir}/kieker.monitoring.example.properties" />
			<zipfileset file="${src.userguide.pdf}" fullpath="${kieker.dist.name}/doc/${dist.kieker.userguide.pdf}" />
			<zipfileset dir="." prefix="${kieker.dist.name}" defaultexcludes="yes">
				<patternset refid="dist_bin_files-nonbinmode" />
			</zipfileset>
			<zipfileset dir="." prefix="${kieker.dist.name}" filemode="755" defaultexcludes="yes">
				<patternset refid="dist_bin_files-binmode" />
			</zipfileset>

			<zipfileset file="${readme.bin.file}" fullpath="${kieker.dist.name}/${readme.file}" />

			<zipfileset file="${kieker.monitoring.default.properties}"
						fullpath="${kieker.dist.name}/${example.javaee.jetty.dir}/kieker.monitoring.properties" />

			<!-- Include tailored Eclipse files in the examples -->
			<zipfileset file="${src.userguide.example.bookstore.dir}/.classpath"
						fullpath="${kieker.dist.name}/${src.userguide.example.bookstore.dir}/.classpath" /> <!-- leave "as-is" -->
			<zipfileset file="${src.userguide.example.manual.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.userguide.example.manual.dir}/.classpath" />
			<zipfileset file="${src.userguide.example.extended.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.userguide.example.extended.dir}/.classpath" />
			<zipfileset file="${src.userguide.example.aspectj.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.userguide.example.aspectj.dir}/.classpath" />
			<zipfileset file="${src.userguide.example.jms.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.userguide.example.jms.dir}/.classpath" />
			<zipfileset file="${src.userguide.example.sigar.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.userguide.example.sigar.dir}/.classpath" />

			<zipfileset file="${src.example.analysis.kax.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.analysis.kax.dir}/.classpath" />	
			<zipfileset file="${src.example.analysis.opad.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.analysis.opad.dir}/.classpath" />				
			<zipfileset file="${src.example.monitoring.adaptive.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.monitoring.adaptive.dir}/.classpath" />	
			<zipfileset file="${src.example.monitoring.timesource.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.monitoring.timesource.dir}/.classpath" />	
			<zipfileset file="${src.example.monitoring.aspectj.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.monitoring.aspectj.dir}/.classpath" />	
			<zipfileset file="${src.example.monitoring.manual.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.monitoring.manual.dir}/.classpath" />	
			<zipfileset file="${src.example.monitoring.spring.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.monitoring.spring.dir}/.classpath" />	
			<zipfileset file="${src.example.monitoring.jvm.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.monitoring.jvm.dir}/.classpath" />	
			<zipfileset file="${src.example.monitoring.sigar.dir}/.classpath-binrelease.generated"
						fullpath="${kieker.dist.name}/${src.example.monitoring.sigar.dir}/.classpath" />						
						
			<!-- Include the right Kieker libs in the examples -->
			<zipfileset file="${dist.dir}/${dist.kieker.main.aspectj.jar}"
						prefix="${kieker.dist.name}/${example.javaee.jetty.dir}/webapps/jpetstore/WEB-INF/lib" />
			<zipfileset file="${license.file}"
						fullpath="${kieker.dist.name}/${example.javaee.jetty.dir}/webapps/jpetstore/WEB-INF/lib/${dist.kieker.main.aspectj.jar}.LICENSE" />
			<zipfileset file="${dist.dir}/${dist.kieker.main.emf.jar}"
						prefix="${kieker.dist.name}/${src.userguide.example.manual.dir}/lib" />
			<zipfileset file="${dist.dir}/${dist.kieker.main.emf.jar}"
						prefix="${kieker.dist.name}/${src.userguide.example.extended.dir}/lib" />
			<zipfileset file="${dist.dir}/${dist.kieker.main.aspectj.jar}"
						prefix="${kieker.dist.name}/${src.userguide.example.aspectj.dir}/lib" />
			<zipfileset file="${dist.dir}/${dist.kieker.main.emf.jar}"
						prefix="${kieker.dist.name}/${src.userguide.example.jms.dir}/lib" />
			<zipfileset file="${lib.dir}/commons-logging-*.jar"
						prefix="${kieker.dist.name}/${src.userguide.example.jms.dir}/lib" />
			<zipfileset file="${dist.dir}/${dist.kieker.main.emf.jar}"
						prefix="${kieker.dist.name}/${src.userguide.example.sigar.dir}/lib" />
			<zipfileset file="${dist.dir}/${dist.kieker.main.emf.jar}"
						prefix="${kieker.dist.name}/${example.javaee.demo.lib.dir}" />
			<zipfileset file="${license.file}"
						fullpath="${kieker.dist.name}/${example.javaee.demo.lib.dir}/${dist.kieker.main.emf.jar}.LICENSE" />
			<zipfileset file="${lib.sigar.dir}/*"
						prefix="${kieker.dist.name}/${src.userguide.example.sigar.dir}/lib" />
			<zipfileset file="${lib.sigar.dir}/*"
						prefix="${kieker.dist.name}/${example.javaee.jpetstore.lib.dir}" />
			<zipfileset file="${dist.dir}/${dist.kieker.main.emf.jar}"
						prefix="${kieker.dist.name}/${src.example.analysis.kax.dir}/lib" />	
			<zipfileset file="${dist.dir}/${dist.kieker.main.emf.jar}"
						prefix="${kieker.dist.name}/${src.example.analysis.opad.dir}/lib" />				
			<zipfileset file="${dist.dir}/${dist.kieker.main.aspectj.jar}"
						prefix="${kieker.dist.name}/${src.example.monitoring.aspectj.dir}/lib" />	
			<zipfileset file="${lib.dir}/commons-lang3-*.jar"
						prefix="${kieker.dist.name}/${src.example.analysis.opad.dir}/lib" />
			<zipfileset file="${lib.dir}/commons-math3-*.jar"
						prefix="${kieker.dist.name}/${src.example.analysis.opad.dir}/lib" />			
			<zipfileset file="${dist.dir}/${dist.kieker.main.aspectj.jar}"
						prefix="${kieker.dist.name}/${src.example.monitoring.adaptive.dir}/lib" />		
			<zipfileset file="${dist.dir}/${dist.kieker.main.aspectj.jar}"
						prefix="${kieker.dist.name}/${src.example.monitoring.timesource.dir}/lib" />	
			<zipfileset file="${dist.dir}/${dist.kieker.main.jar}"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />	
			<zipfileset file="${dist.dir}/${dist.kieker.main.jar}"
						prefix="${kieker.dist.name}/${src.example.monitoring.manual.dir}/lib" />	
			<zipfileset file="${dist.dir}/${dist.kieker.main.jar}"
						prefix="${kieker.dist.name}/${src.example.monitoring.jvm.dir}/lib" />	
			<zipfileset file="${dist.dir}/${dist.kieker.main.jar}"
						prefix="${kieker.dist.name}/${src.example.monitoring.sigar.dir}/lib" />		
			<zipfileset file="${lib.sigar.dir}/*"
						prefix="${kieker.dist.name}/${src.example.monitoring.sigar.dir}/lib" />		
			<zipfileset file="${lib.spring.dir}/aopalliance-*.jar"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />				
			<zipfileset file="${lib.spring.dir}/spring-aop-*.jar"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />	
			<zipfileset file="${lib.spring.dir}/spring-beans-*.jar"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />				
			<zipfileset file="${lib.spring.dir}/spring-context-*.jar"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />	
			<zipfileset file="${lib.spring.dir}/spring-core-*.jar"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />	
			<zipfileset file="${lib.spring.dir}/spring-expression-*.jar"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />
			<zipfileset file="${lib.dir}/aspectjweaver-*.jar"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />
			<zipfileset file="${lib.dir}/commons-logging-*.jar"
						prefix="${kieker.dist.name}/${src.example.monitoring.spring.dir}/lib" />						
		</zip>
	</target>

	<target name="dist-examples" depends="-update-version.examples" description="Packages the example archives (.zip|.tar.gz) for a release">
	</target>

	<target name="release" depends="build-all,dist-kieker-sources,dist-kieker-binaries,dist-kieker-javadoc,dist-examples,dist-kieker-userguide,dist-maven" description="Packages the release files (calling all dist- targets)">
		<echo message="Sourceforge release instructions can be found at:" />
		<echo message="https://sourceforge.net/apps/trac/sourceforge/wiki/Release files for download#Createoreditarelease" />
		<echo message="" />
		<echo message="Note that this target executes only on platforms having 'make' and 'sh' installed" />
	</target>

	<target name="release-with-archive-check" depends="release">
		<echo message="Checking release archives ..." />
		<exec executable="${tests.release-script.sh}" failonerror="true">
			<arg value="-C" />
			<arg value="." />
		</exec>
	</target>

	<target name="enable-r-tests" depends="">
		<property name="rTestsEnabled" value="true" />
	</target>
	
	<!-- http://kieker.uni-kiel.de/trac/ticket/292: add run-tests-integration BEFORE static-analysis -->
	<target name="run-hudson-kieker" depends="enable-r-tests,build-all,run-tests-junit,static-analysis" description="Ant target used by the Hudson build (includes run-tests-junit,run-tests-integration,static-analysis)" />

</project>
